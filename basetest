package base;

import org.testng.annotations.DataProvider;
import utils.XLUtility;

import java.util.ArrayList;
import java.util.List;

public class BaseTest {

    protected static XLUtility excel;

    static {
        try {
            excel = new XLUtility("testdata.xlsx");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // DataProvider for Register test
    @DataProvider(name = "registerData")
    public Object[][] getRegisterData() throws Exception {
        return getDataFromExcel("Register", new int[]{1, 2, 3, 4, 5, 6}); // Columns for testType, testName, baseUrl, endpoint, username, password
    }

    // DataProvider for GetAllUsers test
    @DataProvider(name = "getAllUsersData")
    public Object[][] getAllUsersData() throws Exception {
        return getDataFromExcel("GetAllUsers", new int[]{1, 2, 3}); // Columns for testName, baseUrl, endpoint
    }

    // Generic method to get only needed columns
    protected Object[][] getDataFromExcel(String testType, int[] colIndices) throws Exception {
        int rowCount = excel.getRowCount("Tests");
        List<Object[]> dataList = new ArrayList<>();

        for (int i = 1; i <= rowCount; i++) {
            String type = excel.getCellData("Tests", i, 0); // Column A = TestType
            if (type.equalsIgnoreCase(testType)) {
                Object[] rowData = new Object[colIndices.length];
                for (int j = 0; j < colIndices.length; j++) {
                    rowData[j] = excel.getCellData("Tests", i, colIndices[j]);
                }
                dataList.add(rowData);
            }
        }

        return dataList.toArray(new Object[0][]);
    }
}
